Use a disjoint set data structure to handle queries of type $2$.
You also need to run BFS to handle queries of type $3$.